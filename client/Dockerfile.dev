FROM node:20-alpine3.19

# Install pnpm
RUN npm install -g pnpm

WORKDIR /app

# Copy workspace config and package files
COPY pnpm-workspace.yaml ./
COPY packages/shared/package.json ./packages/shared/
COPY client/package.json ./client/

# Copy shared sources for build
COPY packages/shared/ ./packages/shared/

# Install dependencies with pnpm
WORKDIR /app/client
RUN --mount=type=cache,target=/root/.local/share/pnpm \
    pnpm install

# Copy client source
COPY client/ .

CMD ["pnpm", "dev"]
